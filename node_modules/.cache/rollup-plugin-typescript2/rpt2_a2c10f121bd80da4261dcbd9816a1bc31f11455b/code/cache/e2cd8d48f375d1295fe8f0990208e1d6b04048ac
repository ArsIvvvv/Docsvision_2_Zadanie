{"code":"import { __awaiter, __generator } from \"tslib\";\r\nimport { $MessageBox } from \"@docsvision/webclient/System/$MessageBox\";\r\nvar ApplicationLogic = /** @class */ (function () {\r\n    function ApplicationLogic() {\r\n    }\r\n    // ========== ЛОГИКА СОХРАНЕНИЯ ==========\r\n    ApplicationLogic.prototype.validateBeforeSave = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var messageBoxSvc, daysControl, daysValue, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        messageBoxSvc = layout.getService($MessageBox);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 8, , 10]);\r\n                        daysControl = layout.controls.get(\"KolDays\");\r\n                        if (!!daysControl) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, messageBoxSvc.showError('Контрол \"Количество дней\" не найден!')];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, false];\r\n                    case 3:\r\n                        daysValue = daysControl.params.value;\r\n                        if (!(daysValue === null || daysValue === undefined || daysValue === 0)) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, messageBoxSvc.showWarning('Поле \"Количество дней\" обязательно для заполнения!')];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/, false]; // Отменяем сохранение\r\n                    case 5:\r\n                        if (!(daysValue < 1)) return [3 /*break*/, 7];\r\n                        return [4 /*yield*/, messageBoxSvc.showWarning('Количество дней должно быть больше 0!')];\r\n                    case 6:\r\n                        _a.sent();\r\n                        return [2 /*return*/, false];\r\n                    case 7: return [2 /*return*/, true];\r\n                    case 8:\r\n                        error_1 = _a.sent();\r\n                        console.error('Ошибка при проверке перед сохранением:', error_1);\r\n                        return [4 /*yield*/, messageBoxSvc.showError('Ошибка при проверке данных')];\r\n                    case 9:\r\n                        _a.sent();\r\n                        return [2 /*return*/, false];\r\n                    case 10: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ApplicationLogic.prototype.sendSavingMsg = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, layout.getService($MessageBox).showInfo('Карточка сохраняется...')];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ApplicationLogic.prototype.sendSavedMsg = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, layout.getService($MessageBox).showInfo('Карточка успешно сохранена!')];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ApplicationLogic.prototype.validateDateRange = function (sender) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layout, messageBoxSvc, startDateControl, endDateControl, startDateValue, endDateValue, startDate, endDate, error_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layout = sender.layout;\r\n                        messageBoxSvc = layout.getService($MessageBox);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 6, , 8]);\r\n                        startDateControl = layout.controls.get(\"StartDate\");\r\n                        endDateControl = layout.controls.get(\"EndDate\");\r\n                        if (!(!startDateControl || !endDateControl)) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, messageBoxSvc.showError('Контролы дат не найдены!')];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 3:\r\n                        startDateValue = startDateControl.value;\r\n                        endDateValue = endDateControl.value;\r\n                        if (!(startDateValue && endDateValue)) return [3 /*break*/, 5];\r\n                        startDate = new Date(startDateValue);\r\n                        endDate = new Date(endDateValue);\r\n                        if (!(endDate <= startDate)) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, messageBoxSvc.showError('Дата окончания должна быть больше даты начала!')];\r\n                    case 4:\r\n                        _a.sent();\r\n                        // Сбрасываем значение контрола, который вызвал изменение\r\n                        sender.value = null;\r\n                        _a.label = 5;\r\n                    case 5: return [3 /*break*/, 8];\r\n                    case 6:\r\n                        error_2 = _a.sent();\r\n                        console.error('Ошибка при валидации дат:', error_2);\r\n                        return [4 /*yield*/, messageBoxSvc.showError('Ошибка при проверке дат')];\r\n                    case 7:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 8: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // ========== ЛОГИКА ОТОБРАЖЕНИЯ ИНФОРМАЦИИ ==========\r\n    ApplicationLogic.prototype.showCardInfo = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var messageBoxSvc, documentNameControl, regDateControl, startDateControl, endDateControl, reasonControl, lines, message, error_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!layout) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        messageBoxSvc = layout.getService($MessageBox);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 5]);\r\n                        documentNameControl = layout.controls.get(\"documentName\");\r\n                        regDateControl = layout.controls.get(\"regDate\");\r\n                        startDateControl = layout.controls.get(\"StartDate\");\r\n                        endDateControl = layout.controls.get(\"EndDate\");\r\n                        reasonControl = layout.controls.get(\"Reason\");\r\n                        lines = [\r\n                            \"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u0430\\u0440\\u0442\\u043E\\u0447\\u043A\\u0438: \" + ((documentNameControl === null || documentNameControl === void 0 ? void 0 : documentNameControl.params.value) || 'Не указано'),\r\n                            \"\\u0414\\u0430\\u0442\\u0430 \\u0441\\u043E\\u0437\\u0434\\u0430\\u043D\\u0438\\u044F: \" + ((regDateControl === null || regDateControl === void 0 ? void 0 : regDateControl.params.value) ?\r\n                                new Date(regDateControl.params.value).toLocaleDateString('ru-RU') : 'Не указана'),\r\n                            \"\\u0414\\u0430\\u0442\\u0430 \\u0441: \" + ((startDateControl === null || startDateControl === void 0 ? void 0 : startDateControl.params.value) ?\r\n                                new Date(startDateControl.params.value).toLocaleDateString('ru-RU') : 'Не указана'),\r\n                            \"\\u0414\\u0430\\u0442\\u0430 \\u043F\\u043E: \" + ((endDateControl === null || endDateControl === void 0 ? void 0 : endDateControl.params.value) ?\r\n                                new Date(endDateControl.params.value).toLocaleDateString('ru-RU') : 'Не указана'),\r\n                            \"\\u041E\\u0441\\u043D\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0434\\u043B\\u044F \\u043F\\u043E\\u0435\\u0437\\u0434\\u043A\\u0438: \" + (reasonControl.params.value || 'Не указано')\r\n                        ];\r\n                        message = lines.join('\\n');\r\n                        return [4 /*yield*/, messageBoxSvc.showInfo(message, \"Информация о командировке\")];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        error_3 = _a.sent();\r\n                        console.error('Ошибка при отображении информации о карточке:', error_3);\r\n                        return [4 /*yield*/, messageBoxSvc.showError(\"Произошла ошибка при получении данных\")];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ApplicationLogic;\r\n}());\r\nexport { ApplicationLogic };\r\n//# sourceMappingURL=ApplicationLogic.js.map","references":["C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/System/$Layout.d.ts","C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/System/$MessageBox.d.ts","C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/Platform/DateTimePicker.d.ts","C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/Platform/TextBox.d.ts","C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/Platform/Number.d.ts","C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/Legacy/TextareaControl.d.ts","C:/Users/ivlev/OneDrive/Рабочий стол/Тестовое DocsVision/ExampleWebExtension/node_modules/@docsvision/webclient/Platform/TextArea.d.ts"],"map":"{\"version\":3,\"file\":\"ApplicationLogic.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/Logic/ApplicationLogic.ts\"],\"names\":[],\"mappings\":\";AACA,OAAO,EAAE,WAAW,EAAE,MAAM,0CAA0C,CAAC;AAQvE;IAAA;IAoHA,CAAC;IAlHG,0CAA0C;IAE7B,6CAAkB,GAA/B,UAAgC,MAAe;;;;;;wBACzC,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;;;;wBAI3C,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAgB,SAAS,CAAC,CAAC;6BAE9D,CAAC,WAAW,EAAZ,wBAAY;wBACZ,qBAAM,aAAa,CAAC,SAAS,CAAC,sCAAsC,CAAC,EAAA;;wBAArE,SAAqE,CAAC;wBACtE,sBAAO,KAAK,EAAC;;wBAGX,SAAS,GAAG,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC;6BAGvC,CAAA,SAAS,KAAK,IAAI,IAAI,SAAS,KAAK,SAAS,IAAI,SAAS,KAAK,CAAC,CAAA,EAAhE,wBAAgE;wBAChE,qBAAM,aAAa,CAAC,WAAW,CAAC,oDAAoD,CAAC,EAAA;;wBAArF,SAAqF,CAAC;wBACtF,sBAAO,KAAK,EAAC,CAAC,sBAAsB;;6BAIpC,CAAA,SAAS,GAAG,CAAC,CAAA,EAAb,wBAAa;wBACb,qBAAM,aAAa,CAAC,WAAW,CAAC,uCAAuC,CAAC,EAAA;;wBAAxE,SAAwE,CAAC;wBACzE,sBAAO,KAAK,EAAC;4BAGjB,sBAAO,IAAI,EAAC;;;wBAGZ,OAAO,CAAC,KAAK,CAAC,wCAAwC,EAAE,OAAK,CAAC,CAAC;wBAC/D,qBAAM,aAAa,CAAC,SAAS,CAAC,4BAA4B,CAAC,EAAA;;wBAA3D,SAA2D,CAAC;wBAC5D,sBAAO,KAAK,EAAC;;;;;KAEpB;IAEgB,wCAAa,GAA1B,UAA2B,MAAe;;;;4BACtC,qBAAM,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,QAAQ,CAAC,yBAAyB,CAAC,EAAA;;wBAAxE,SAAwE,CAAC;;;;;KAC5E;IAEY,uCAAY,GAAzB,UAA0B,MAAe;;;;4BACrC,qBAAM,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,QAAQ,CAAC,6BAA6B,CAAC,EAAA;;wBAA5E,SAA4E,CAAC;;;;;KAChF;IAEY,4CAAiB,GAA9B,UAA+B,MAAsB;;;;;;wBAC3C,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;wBACvB,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;;;;wBAG3C,gBAAgB,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAiB,WAAW,CAAC,CAAC;wBACpE,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAiB,SAAS,CAAC,CAAC;6BAElE,CAAA,CAAC,gBAAgB,IAAI,CAAC,cAAc,CAAA,EAApC,wBAAoC;wBACpC,qBAAM,aAAa,CAAC,SAAS,CAAC,0BAA0B,CAAC,EAAA;;wBAAzD,SAAyD,CAAC;wBAC1D,sBAAO;;wBAGL,cAAc,GAAG,gBAAgB,CAAC,KAAK,CAAC;wBACxC,YAAY,GAAG,cAAc,CAAC,KAAK,CAAC;6BAGtC,CAAA,cAAc,IAAI,YAAY,CAAA,EAA9B,wBAA8B;wBACxB,SAAS,GAAG,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC;wBACrC,OAAO,GAAG,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC;6BAEnC,CAAA,OAAO,IAAI,SAAS,CAAA,EAApB,wBAAoB;wBACpB,qBAAM,aAAa,CAAC,SAAS,CAAC,gDAAgD,CAAC,EAAA;;wBAA/E,SAA+E,CAAC;wBAEhF,yDAAyD;wBACzD,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;;;;;wBAI5B,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,OAAK,CAAC,CAAC;wBAClD,qBAAM,aAAa,CAAC,SAAS,CAAC,yBAAyB,CAAC,EAAA;;wBAAxD,SAAwD,CAAC;;;;;;KAEhE;IAED,sDAAsD;IAEzC,uCAAY,GAAzB,UAA0B,MAAe;;;;;;wBACzC,IAAI,CAAC,MAAM,EAAE;4BAAE,sBAAO;yBAAE;wBAElB,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;;;;wBAG3C,mBAAmB,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAU,cAAc,CAAC,CAAC;wBACnE,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAiB,SAAS,CAAC,CAAC;wBAChE,gBAAgB,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAiB,WAAW,CAAC,CAAC;wBACpE,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAiB,SAAS,CAAC,CAAC;wBAChE,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;wBAGxD,KAAK,GAAG;4BACV,yGAAsB,CAAA,mBAAmB,aAAnB,mBAAmB,uBAAnB,mBAAmB,CAAE,MAAM,CAAC,KAAK,KAAI,YAAY,CAAE;4BACzE,iFAAkB,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,MAAM,CAAC,KAAK,EAAC,CAAC;gCAC5C,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,YAAY,CAAE;4BACtF,uCAAW,CAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,MAAM,CAAC,KAAK,EAAC,CAAC;gCACvC,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,YAAY,CAAE;4BACxF,6CAAY,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,MAAM,CAAC,KAAK,EAAC,CAAC;gCACtC,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,YAAY,CAAE;4BACtF,4HAA0B,aAAa,CAAC,MAAM,CAAC,KAAK,IAAI,YAAY,CAAE;yBACzE,CAAC;wBAGI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBACjC,qBAAM,aAAa,CAAC,QAAQ,CAAC,OAAO,EAAE,2BAA2B,CAAC,EAAA;;wBAAlE,SAAkE,CAAC;;;;wBAGnE,OAAO,CAAC,KAAK,CAAC,+CAA+C,EAAE,OAAK,CAAC,CAAC;wBACtE,qBAAM,aAAa,CAAC,SAAS,CAAC,uCAAuC,CAAC,EAAA;;wBAAtE,SAAsE,CAAC;;;;;;KAE9E;IACD,uBAAC;AAAD,CAAC,AApHD,IAoHC\"}"}
