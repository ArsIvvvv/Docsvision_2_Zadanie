{"version":3,"file":"extension.js","sources":["../../../../src/Logic/ApplicationLogic.ts","../../../../src/EventHandlers/ApplicationEventHandlers.ts","../../../../src/Index.ts"],"sourcesContent":["import { ILayout } from \"@docsvision/webclient/System/$Layout\";\r\nimport { $MessageBox } from \"@docsvision/webclient/System/$MessageBox\";\r\nimport { DateTimePicker } from \"@docsvision/webclient/Platform/DateTimePicker\";\r\nimport { TextBox } from \"@docsvision/webclient/Platform/TextBox\";\r\nimport { NumberControl } from \"@docsvision/webclient/Platform/Number\";\r\nimport { TextareaControl } from \"@docsvision/webclient/Legacy/TextareaControl\";\r\nimport { TextArea, TextAreaParams } from \"@docsvision/webclient/Platform/TextArea\";\r\n\r\n\r\nexport class ApplicationLogic {\r\n    \r\n    // ========== ЛОГИКА СОХРАНЕНИЯ ==========\r\n    \r\n    public async validateBeforeSave(layout: ILayout): Promise<boolean> {\r\n    const messageBoxSvc = layout.getService($MessageBox);\r\n    \r\n    try {\r\n        // Проверяем контрол \"Количество дней\" на заполнение\r\n        const daysControl = layout.controls.get<NumberControl>(\"KolDays\");\r\n        \r\n        if (!daysControl) {\r\n            await messageBoxSvc.showError('Контрол \"Количество дней\" не найден!');\r\n            return false;\r\n        }\r\n\r\n        const daysValue = daysControl.params.value;\r\n        \r\n        // Проверяем, что поле заполнено (не null, не undefined и не 0)\r\n        if (daysValue === null || daysValue === undefined || daysValue === 0) {\r\n            await messageBoxSvc.showWarning('Поле \"Количество дней\" обязательно для заполнения!');\r\n            return false; // Отменяем сохранение\r\n        }\r\n\r\n        // Дополнительная проверка: количество дней должно быть положительным\r\n        if (daysValue < 1) {\r\n            await messageBoxSvc.showWarning('Количество дней должно быть больше 0!');\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n\r\n    } catch (error) {\r\n        console.error('Ошибка при проверке перед сохранением:', error);\r\n        await messageBoxSvc.showError('Ошибка при проверке данных');\r\n        return false;\r\n    }\r\n}\r\n\r\n    public async sendSavingMsg(layout: ILayout): Promise<void> {\r\n        await layout.getService($MessageBox).showInfo('Карточка сохраняется...');\r\n    }\r\n\r\n    public async sendSavedMsg(layout: ILayout): Promise<void> {\r\n        await layout.getService($MessageBox).showInfo('Карточка успешно сохранена!');\r\n    }\r\n\r\n    public async validateDateRange(sender: DateTimePicker): Promise<void> {\r\n        const layout = sender.layout;\r\n        const messageBoxSvc = layout.getService($MessageBox);\r\n\r\n        try {\r\n            const startDateControl = layout.controls.get<DateTimePicker>(\"StartDate\");\r\n            const endDateControl = layout.controls.get<DateTimePicker>(\"EndDate\");\r\n\r\n            if (!startDateControl || !endDateControl) {\r\n                await messageBoxSvc.showError('Контролы дат не найдены!');\r\n                return;\r\n            }\r\n\r\n            const startDateValue = startDateControl.value;\r\n            const endDateValue = endDateControl.value;\r\n\r\n            // Если обе даты заполнены, проверяем корректность\r\n            if (startDateValue && endDateValue) {\r\n                const startDate = new Date(startDateValue);\r\n                const endDate = new Date(endDateValue);\r\n\r\n                if (endDate <= startDate) {\r\n                    await messageBoxSvc.showError('Дата окончания должна быть больше даты начала!');\r\n                    \r\n                    // Сбрасываем значение контрола, который вызвал изменение\r\n                    sender.value = null;\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Ошибка при валидации дат:', error);\r\n            await messageBoxSvc.showError('Ошибка при проверке дат');\r\n        }\r\n    }\r\n\r\n    // ========== ЛОГИКА ОТОБРАЖЕНИЯ ИНФОРМАЦИИ ==========\r\n\r\n    public async showCardInfo(layout: ILayout): Promise<void> {\r\n    if (!layout) { return; }\r\n    \r\n    const messageBoxSvc = layout.getService($MessageBox);\r\n    \r\n    try {\r\n        const documentNameControl = layout.controls.get<TextBox>(\"documentName\");\r\n        const regDateControl = layout.controls.get<DateTimePicker>(\"regDate\");\r\n        const startDateControl = layout.controls.get<DateTimePicker>(\"StartDate\");\r\n        const endDateControl = layout.controls.get<DateTimePicker>(\"EndDate\");\r\n        const reasonControl = layout.controls.get<TextArea>(\"Reason\");\r\n\r\n        // Формируем строки информации\r\n        const lines = [\r\n            `Название карточки: ${documentNameControl?.params.value || 'Не указано'}`,\r\n            `Дата создания: ${regDateControl?.params.value ? \r\n                new Date(regDateControl.params.value).toLocaleDateString('ru-RU') : 'Не указана'}`,\r\n            `Дата с: ${startDateControl?.params.value ? \r\n                new Date(startDateControl.params.value).toLocaleDateString('ru-RU') : 'Не указана'}`,\r\n            `Дата по: ${endDateControl?.params.value ? \r\n                new Date(endDateControl.params.value).toLocaleDateString('ru-RU') : 'Не указана'}`,\r\n            `Основание для поездки: ${reasonControl.params.value || 'Не указано'}`\r\n        ];\r\n\r\n        // Объединяем строки и показываем сообщение\r\n        const message = lines.join('\\n');\r\n        await messageBoxSvc.showInfo(message, \"Информация о командировке\");\r\n\r\n    } catch (error) {\r\n        console.error('Ошибка при отображении информации о карточке:', error);\r\n        await messageBoxSvc.showError(\"Произошла ошибка при получении данных\");\r\n    }\r\n}\r\n}","import { ApplicationLogic } from \"../Logic/ApplicationLogic\";\r\nimport { ILayout } from \"@docsvision/webclient/System/$Layout\";\r\nimport { $MessageBox } from \"@docsvision/webclient/System/$MessageBox\";\r\nimport { IEventArgs } from \"@docsvision/webclient/System/IEventArgs\";\r\nimport { DateTimePicker } from \"@docsvision/webclient/Platform/DateTimePicker\";\r\nimport { NumberControl } from \"@docsvision/webclient/Platform/Number\";\r\n\r\n// ========== СОХРАНЕНИЕ КАРТОЧКИ ==========\r\n\r\nexport async function ddApplication_OnSaving(sender: ILayout, args: IEventArgs): Promise<void> {\r\n    const logic = new ApplicationLogic();\r\n    \r\n    // Проверяем заполнение обязательного поля перед сохранением\r\n    const isValid = await logic.validateBeforeSave(sender);\r\n    if (!isValid) {\r\n        // Отменяем сохранение если проверка не пройдена\r\n        (args as any).savingCancelled = true;\r\n        return;\r\n    }\r\n    \r\n    console.log('Карточка сохраняется...');\r\n    await logic.sendSavingMsg(sender);\r\n}\r\n\r\n\r\nexport async function ddApplication_OnSaved(sender: ILayout, args: IEventArgs): Promise<void> {\r\n    const logic = new ApplicationLogic();\r\n    await logic.sendSavedMsg(sender);\r\n}\r\n\r\n// ========== ОБРАБОТКА ДАТ ==========\r\n\r\nexport async function ddDateRange_OnDateChange(sender: DateTimePicker, args: IEventArgs): Promise<void> {\r\n    const logic = new ApplicationLogic();\r\n    await logic.validateDateRange(sender);\r\n}\r\n\r\n// ========== КНОПКА ИНФОРМАЦИИ ==========\r\n\r\nexport async function ddShowCardInfo_OnClick(sender: any, args: IEventArgs): Promise<void> {\r\n    const logic = new ApplicationLogic();\r\n    // Передаем layout вместо sender\r\n    await logic.showCardInfo(sender.layout);\r\n}\r\n","﻿\r\nimport * as ApplicationEventHandlers from \"./EventHandlers/ApplicationEventHandlers\";\r\nimport { extensionManager } from \"@docsvision/webclient/System/ExtensionManager\";\r\n\r\n// Регистрация расширения\r\nextensionManager.registerExtension({\r\n    name: \"MyWebExtension\",\r\n    version: \"1.0\",\r\n    globalEventHandlers: [ApplicationEventHandlers],\r\n    layoutServices: [],\r\n    controls: []\r\n});"],"names":["$MessageBox","extensionManager"],"mappings":"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"}